<div class="well">
  <div class="row">
    <div class="control-group">

      <legend>Permissions</legend>
      <div class="controls">
        <div style="width:220px; padding-left:5px; float:left;">Person / Group</div>
        <div style="width:220px; padding-left:5px; float:left;">Access level</div><br/>
      </div>
      <div id="permissions" class="control-group">
        <% added = false %>
        <% access_types = {"Access level"=>"", "Read and download"=>"read", "Edit" => "edit"} %>
        <% p_index = 0 %>
        <% @article.permissions.each do |p| %>
          <% if p.type.downcase == "group" || p.name == @article.workflowMetadata.depositor[0] %>
            <div class="controls" id="permissions_clone_<%=p_index%>">
              <div class="uneditable-input" style="width:210px;"><%= p.name %></div>
              <div class="uneditable-input" style="width:210px;"><%= p.access %></div>
            </div>
            <% p_index += 1 %>
          <% end %>
        <% end %>
        <% @article.permissions.each do |p| %>
          <% if p.type.downcase != "group" && p.name != @article.workflowMetadata.depositor[0] %>
            <div class="controls" id="permissions_clone_<%=p_index%>">
              <%= hidden_field_tag "article[permissions_attributes][][type]", p.type, id: nil %>
              <%= text_field_tag "article[permissions_attributes][][name]", p.name, :class=>"permissionName", id: "permissionName%d"% p_index %>
              <%= select_tag "article[permissions_attributes][][access]", options_for_select(access_types, :selected=>p.access), id: "permissionAccess%d"% p_index %>
              <% if added == false %> 
                <button class="adder btn" name="additional_permissions" id="permissions_button_<%=p_index%>" type="button">+<span class="accessible-hidden">Grant permissions to another</span></button>
                &nbsp;
                <%= help_icon(:permissions) %>
                <% added = true %>
              <% end %>
            </div>
            <% p_index += 1 %>
          <% end %>
        <% end %>
        <% if added == false %>
          <div class="controls" id="permissions_clone_<%=p_index%>">
            <%= hidden_field_tag "article[permissions_attributes][][type]", "user", id: nil %>
            <%= text_field_tag "article[permissions_attributes][][name]", "", :class=>"permissionName", id: "permissionName%d"% p_index %>
            <%= select_tag "article[permissions_attributes][][access]", options_for_select(access_types), id: "permissionAccess%d"% p_index %>
            <button class="adder btn" name="additional_permissions" id="permissions_button_<%=p_index%>" type="button">+<span class="accessible-hidden">Grant permissions to another</span></button>
            &nbsp;
            <%= help_icon(:permissions) %>
            <% added = true %>
          </div>
        <% end %>
      </div>

    </div><!-- /.control-group -->
  </div> <!-- /.row -->
</div> <!-- /.well -->

